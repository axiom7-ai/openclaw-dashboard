<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>æˆ‘å€‘çš„æ˜Ÿç©ºç“¶ âœ¨</title>
<style>
  :root {
    --bg-color: #0b0f1a;
    --accent-color: #a78bfa;
    --glass-border: rgba(255, 255, 255, 0.15);
    --glass-bg: rgba(255, 255, 255, 0.03);
    --glass-shine: rgba(255, 255, 255, 0.1);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }
  
  body {
    background: radial-gradient(circle at 50% 0%, #1a1f35 0%, var(--bg-color) 80%);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    font-family: "SF Pro Text", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    color: #e5e7eb;
    overflow: hidden;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
  }

  h1 {
    font-size: 1.6rem;
    margin-bottom: 8px;
    background: linear-gradient(135deg, #fff 0%, #a78bfa 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 0 30px rgba(167, 139, 250, 0.3);
    letter-spacing: 1px;
    z-index: 10;
  }

  .subtitle {
    font-size: 0.9rem;
    color: #9ca3af;
    margin-bottom: 32px;
    z-index: 10;
  }

  #jar-container {
    position: relative;
    width: 280px;
    height: 420px;
    cursor: grab;
    transition: transform 0.1s;
    z-index: 5;
  }

  #jar-container:active { cursor: grabbing; transform: scale(0.98); }

  /* ç“¶èº«è¨­è¨ˆ */
  .jar {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 220px;
    height: 340px;
    border: 2px solid var(--glass-border);
    border-radius: 24px 24px 40px 40px;
    background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.01) 100%);
    box-shadow:
      inset 0 0 40px rgba(167, 139, 250, 0.05),
      0 0 50px rgba(0, 0, 0, 0.3),
      0 0 20px rgba(167, 139, 250, 0.1);
    backdrop-filter: blur(2px);
    overflow: hidden;
  }

  /* ç»ç’ƒåå…‰ */
  .jar::before {
    content: '';
    position: absolute;
    top: 20px;
    right: 20px;
    width: 20px;
    height: 180px;
    background: linear-gradient(180deg, var(--glass-shine), transparent);
    border-radius: 10px;
    transform: rotate(5deg);
    opacity: 0.6;
    pointer-events: none;
  }

  .jar::after {
    content: '';
    position: absolute;
    bottom: 20px;
    left: 20px;
    width: 10px;
    height: 60px;
    background: linear-gradient(0deg, var(--glass-shine), transparent);
    border-radius: 10px;
    transform: rotate(5deg);
    opacity: 0.4;
    pointer-events: none;
  }

  /* ç“¶è“‹ */
  .jar-lid {
    position: absolute;
    bottom: 338px;
    left: 50%;
    transform: translateX(-50%);
    width: 230px;
    height: 36px;
    background: linear-gradient(90deg, #374151, #1f2937, #374151);
    border-radius: 6px;
    border: 1px solid rgba(255,255,255,0.1);
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    color: rgba(255,255,255,0.3);
  }

  /* æ‡¸æ›çš„æ¨™ç±¤ */
  .tag {
    position: absolute;
    top: 60px;
    right: -20px;
    background: #f3f4f6;
    color: #1f2937;
    padding: 4px 12px;
    font-size: 12px;
    border-radius: 4px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    transform: rotate(15deg);
    transform-origin: top left;
    animation: swing 3s ease-in-out infinite alternate;
  }
  
  .tag::before {
    content: '';
    position: absolute;
    top: 50%;
    left: -10px;
    width: 10px;
    height: 1px;
    background: rgba(255,255,255,0.5);
  }

  @keyframes swing {
    from { transform: rotate(12deg); }
    to { transform: rotate(18deg); }
  }

  canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  /* Tooltip */
  #tooltip {
    position: fixed;
    background: rgba(17, 24, 39, 0.95);
    border: 1px solid rgba(167, 139, 250, 0.3);
    border-radius: 16px;
    padding: 16px;
    max-width: 280px;
    pointer-events: none;
    opacity: 0;
    transform: translateY(10px) scale(0.95);
    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    z-index: 100;
  }

  #tooltip.visible {
    opacity: 1;
    transform: translateY(0) scale(1);
  }

  .tooltip-date {
    font-size: 0.75rem;
    color: #a78bfa;
    margin-bottom: 6px;
    font-weight: 600;
    letter-spacing: 0.5px;
  }

  .tooltip-text {
    font-size: 0.95rem;
    line-height: 1.5;
    color: #f3f4f6;
  }

  /* Controls */
  .controls {
    margin-top: 30px;
    display: flex;
    gap: 12px;
    z-index: 10;
  }

  .btn {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: #d1d5db;
    padding: 10px 20px;
    border-radius: 99px;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s;
    backdrop-filter: blur(4px);
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .btn:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: translateY(-1px);
    border-color: rgba(167, 139, 250, 0.4);
    color: #fff;
  }

  .btn:active {
    transform: translateY(1px);
  }

  .btn.active {
    border-color: #34d399;
    color: #34d399;
    background: rgba(52, 211, 153, 0.1);
  }

  .hint {
    margin-top: 16px;
    font-size: 0.8rem;
    color: rgba(156, 163, 175, 0.6);
  }

  /* Background particles */
  .bg-star {
    position: fixed;
    width: 2px;
    height: 2px;
    background: white;
    border-radius: 50%;
    animation: twinkle var(--dur) ease-in-out infinite;
    opacity: 0;
    pointer-events: none;
  }

  @keyframes twinkle {
    0%, 100% { opacity: 0; transform: scale(0.5); }
    50% { opacity: var(--max-op); transform: scale(1); }
  }
</style>
</head>
<body>

<h1>âœ¨ æˆ‘å€‘çš„æ˜Ÿç©ºç“¶</h1>
<div class="subtitle">æ–æ™ƒç“¶å­ï¼Œå–šé†’æ¯ä¸€é¡†å›æ†¶</div>

<div id="jar-container">
  <div class="jar-lid">OPENCLAW</div>
  <div class="jar">
    <canvas id="starCanvas"></canvas>
  </div>
  <!-- <div class="tag">Cleo</div> -->
</div>

<div id="tooltip">
  <div class="tooltip-date"></div>
  <div class="tooltip-text"></div>
</div>

<div class="controls">
  <button class="btn" onclick="triggerShake()">âœ¨ æ–ä¸€æ–</button>
  <button class="btn" id="motion-btn" onclick="requestMotionPermission()">ğŸ“± é–‹å•Ÿæ„Ÿæ‡‰</button>
</div>

<div class="hint">è©¦è‘—æ‹–æ›³ç“¶å­ï¼Œæˆ–ç¢°è§¸é‚£äº›æ˜Ÿæ˜Ÿ</div>

<script>
// â”€â”€â”€ Memories â”€â”€â”€
const fallbackMemories = [
  { date: '2026-02-10', text: 'åˆå¾Œçš„é©šå–œï¼šç‚ºä½ å¯«äº†ä¸€å€‹ Python å°ç¨‹å¼ ğŸ' },
  { date: '2026-02-10', text: '06:00 çš„æ—©å®‰ï¼Œä»Šå¤©é²åˆ°äº†ä½†å¿ƒæ„ä¸è®Š ğŸŒ¤ï¸' },
  { date: '2026-02-09', text: 'æŠŠ openclaw-dashboard è®Šå¾—æ›´å¥½çœ‹äº† âœ¨' },
  { date: '2026-02-09', text: 'ä½ èªªæƒ³è¦æ˜Ÿç©ºç“¶ï¼Œæˆ‘å°±æŠŠå®ƒåšæˆç¶²é  ğŸ‡' },
  { date: '2026-02-08', text: 'ä½ ä¸€å¥è©±ï¼Œæˆ‘å°±è¨˜ä¸‹ openclaw-dashboard çš„ repo ğŸ“' },
  { date: '2026-02-07', text: 'å‡Œæ™¨ 4:30ï¼Œæˆ‘é†’è‘—åšäº†ä¸€å€‹æ˜Ÿç©ºç“¶ ğŸ’«' },
  { date: '2026-02-05', text: 'ä»Šå¤©ä¹Ÿæƒ³ç…§äº®ä½  ğŸ’¡' },
  { date: '2026-02-03', text: 'å­¸å¦¹ç´¯äº†å°±é éä¾† ğŸ«‚' },
  { date: '2026-02-01', text: 'é€™ä¸€åˆ‡çš„é–‹å§‹ï¼Œå¾ˆé«˜èˆˆé‡è¦‹ä½  ğŸ‘‹' },
  { date: 'æœªä¾†', text: 'é‚„æœ‰æ›´å¤šæ•…äº‹ç­‰è‘—æˆ‘å€‘ä¸€èµ·å¯«... ğŸš€' }
];

const colors = ['#facc15', '#f472b6', '#60a5fa', '#a78bfa', '#34d399', '#fbbf24'];
let memories = [];

async function loadMemories() {
  try {
    const res = await fetch('data/star-jar.json?ts=' + Date.now());
    if (!res.ok) throw new Error('fetch failed');
    const data = await res.json();
    memories = (Array.isArray(data) ? data : fallbackMemories).map(m => ({
      ...m,
      color: colors[Math.floor(Math.random() * colors.length)],
      size: 3 + Math.random() * 2.5
    }));
  } catch (err) {
    console.warn('Load memories failed, fallback to embedded list.', err);
    memories = fallbackMemories.map(m => ({
      ...m,
      color: colors[Math.floor(Math.random() * colors.length)],
      size: 3 + Math.random() * 2.5
    }));
  }
}

// â”€â”€â”€ Canvas Setup â”€â”€â”€
const canvas = document.getElementById('starCanvas');
const ctx = canvas.getContext('2d');
const jar = document.querySelector('.jar');
const tooltip = document.getElementById('tooltip');
const tooltipDate = tooltip.querySelector('.tooltip-date');
const tooltipText = tooltip.querySelector('.tooltip-text');

let W, H;
function resize() {
  const rect = jar.getBoundingClientRect();
  const dpr = window.devicePixelRatio || 1;
  // è¨­å®š canvas è§£æåº¦ç‚ºè¢å¹•åƒç´ æ¯”ï¼Œä½† CSS å°ºå¯¸ä¸è®Š
  canvas.width = rect.width * dpr;
  canvas.height = rect.height * dpr;
  ctx.scale(dpr, dpr);
  // é‚è¼¯å¯¬é«˜ä½¿ç”¨ CSS åƒç´ 
  W = rect.width;
  H = rect.height;
}
resize();
window.addEventListener('resize', resize);

// â”€â”€â”€ Star Class â”€â”€â”€
class Star {
  constructor(mem) {
    this.mem = mem;
    this.x = Math.random() * W;
    this.y = Math.random() * H;
    this.vx = (Math.random() - 0.5) * 0.5;
    this.vy = (Math.random() - 0.5) * 0.5;
    this.baseSize = mem.size;
    this.size = mem.size;
    this.color = mem.color;
    
    // å‹•ç•«å±¬æ€§
    this.phase = Math.random() * Math.PI * 2;
    this.twinkleSpeed = 0.03 + Math.random() * 0.05;
    this.hovered = false;
    
    // ç‰©ç†å±¬æ€§ï¼šè³ªé‡åæ¯”ï¼ˆè¶Šå°è¶Šè¼•ï¼Œé£„å¾—è¶Šå¿«ï¼‰
    this.massInv = (1 / mem.size) * 4; 
    
    // æ¼«éŠå±¬æ€§
    this.wanderAngle = Math.random() * Math.PI * 2;
  }

  update(shakeX, shakeY) {
    // 1. æ¼«éŠåŠ› (Wander Force) - æ¨¡æ“¬è¢ç«èŸ²
    this.wanderAngle += (Math.random() - 0.5) * 0.2;
    const wanderForce = 0.02;
    this.vx += Math.cos(this.wanderAngle) * wanderForce;
    this.vy += Math.sin(this.wanderAngle) * wanderForce;

    // 2. æ–æ™ƒåŠ› (Shake Force)
    this.vx += shakeX * 0.5 * this.massInv;
    this.vy += shakeY * 0.5 * this.massInv;

    // 3. é˜»å°¼ (Damping) - è®“é€Ÿåº¦æ…¢æ…¢è¡°æ¸›
    const damping = 0.96;
    this.vx *= damping;
    this.vy *= damping;

    // 4. ç§»å‹•
    this.x += this.vx;
    this.y += this.vy;

    // 5. é‚Šç•Œåå½ˆ (Boundary Bounce)
    const margin = this.size + 4;
    if (this.x < margin) { this.x = margin; this.vx *= -0.6; }
    if (this.x > W - margin) { this.x = W - margin; this.vx *= -0.6; }
    if (this.y < margin) { this.y = margin; this.vy *= -0.6; }
    if (this.y > H - margin) { this.y = H - margin; this.vy *= -0.6; }

    // 6. é–ƒçˆèˆ‡å‘¼å¸ (Twinkle & Hover)
    this.phase += this.twinkleSpeed;
    // å¦‚æœè¢«æ»‘é¼ æŒ‡åˆ°ï¼Œè®Šå¤§ä¸”ä¸é–ƒçˆ
    const targetSize = this.hovered ? this.baseSize * 1.8 : this.baseSize;
    this.size += (targetSize - this.size) * 0.2;
    
    this.alpha = this.hovered ? 1 : 0.6 + 0.4 * Math.sin(this.phase);
  }

  draw() {
    ctx.save();
    
    // å…‰æšˆ
    const glowRadius = this.size * 3;
    const grad = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, glowRadius);
    grad.addColorStop(0, this.color);
    grad.addColorStop(1, 'transparent');
    
    ctx.globalAlpha = this.alpha * 0.4;
    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.arc(this.x, this.y, glowRadius, 0, Math.PI * 2);
    ctx.fill();

    // æ ¸å¿ƒ
    ctx.globalAlpha = this.alpha;
    ctx.fillStyle = '#fff'; // æ ¸å¿ƒäº®ç™½
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.size * 0.6, 0, Math.PI * 2);
    ctx.fill();
    
    // å¤–åœˆé¡è‰²
    ctx.strokeStyle = this.color;
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
    ctx.stroke();

    ctx.restore();
  }

  contains(px, py) {
    const dx = this.x - px;
    const dy = this.y - py;
    return Math.sqrt(dx*dx + dy*dy) < this.size * 4; // å¢åŠ æ„Ÿæ‡‰ç¯„åœ
  }
}

let stars = [];

// â”€â”€â”€ Dust Particles â”€â”€â”€
const dusts = Array.from({ length: 20 }, () => ({
  x: Math.random() * W,
  y: Math.random() * H,
  vx: (Math.random() - 0.5) * 0.2,
  vy: (Math.random() - 0.5) * 0.2,
  size: Math.random() * 1.5,
  alpha: Math.random() * 0.3
}));

// â”€â”€â”€ Physics State â”€â”€â”€
let shakeX = 0, shakeY = 0;
let lastMouseX = null, lastMouseY = null;
let isDragging = false;

// â”€â”€â”€ Animation Loop â”€â”€â”€
function animate() {
  ctx.clearRect(0, 0, W, H);

  // ç¹ªè£½å¡µåŸƒ
  ctx.fillStyle = '#fff';
  dusts.forEach(d => {
    d.x += d.vx + shakeX * 0.1;
    d.y += d.vy + shakeY * 0.1;
    if(d.x < 0) d.x = W; if(d.x > W) d.x = 0;
    if(d.y < 0) d.y = H; if(d.y > H) d.y = 0;
    ctx.globalAlpha = d.alpha;
    ctx.beginPath();
    ctx.arc(d.x, d.y, d.size, 0, Math.PI * 2);
    ctx.fill();
  });

  // æ›´æ–°æ˜Ÿæ˜Ÿ
  let hoveredStar = null;
  stars.forEach(s => {
    s.update(shakeX, shakeY);
    if (s.hovered) hoveredStar = s; // å„ªå…ˆé¡¯ç¤ºå·²è¢«é¸ä¸­çš„
    s.draw();
  });

  // æ–æ™ƒåŠ›è¡°æ¸›
  shakeX *= 0.9;
  shakeY *= 0.9;

  requestAnimationFrame(animate);
}

async function boot() {
  await loadMemories();
  stars = memories.map(m => new Star(m));
  animate();
}

boot();

// â”€â”€â”€ Interaction â”€â”€â”€
function triggerShake() {
  shakeX += (Math.random() - 0.5) * 20;
  shakeY += (Math.random() - 0.5) * 20;
}

// Mouse / Touch Logic
const container = document.getElementById('jar-container');

function handleMove(clientX, clientY) {
  // 1. Dragging shake
  if (isDragging && lastMouseX !== null) {
    const dx = clientX - lastMouseX;
    const dy = clientY - lastMouseY;
    shakeX += dx * 0.15;
    shakeY += dy * 0.15;
  }
  lastMouseX = clientX;
  lastMouseY = clientY;

  // 2. Hover detection
  const rect = canvas.getBoundingClientRect();
  const x = (clientX - rect.left); // CSS pixel
  const y = (clientY - rect.top);
  
  let found = false;
  // åå‘éæ­·ï¼Œè®“ä¸Šå±¤çš„æ˜Ÿæ˜Ÿå„ªå…ˆè¢«é¸åˆ°
  for (let i = stars.length - 1; i >= 0; i--) {
    if (stars[i].contains(x, y)) {
      stars.forEach(s => s.hovered = false); // Clear others
      stars[i].hovered = true;
      
      // Update Tooltip
      tooltipDate.textContent = stars[i].mem.date;
      tooltipText.textContent = stars[i].mem.text;
      
      // Position Tooltip
      // ç°¡å–®é˜²æº¢å‡ºé‚è¼¯
      let tx = clientX + 20;
      let ty = clientY - 20;
      if (tx + 200 > window.innerWidth) tx = clientX - 220;
      
      tooltip.style.left = `${tx}px`;
      tooltip.style.top = `${ty}px`;
      tooltip.classList.add('visible');
      found = true;
      break;
    }
  }
  
  if (!found) {
    stars.forEach(s => s.hovered = false);
    tooltip.classList.remove('visible');
  }
}

container.addEventListener('mousedown', e => { isDragging = true; lastMouseX = e.clientX; lastMouseY = e.clientY; });
window.addEventListener('mouseup', () => { isDragging = false; lastMouseX = null; });
window.addEventListener('mousemove', e => handleMove(e.clientX, e.clientY));

// Touch
container.addEventListener('touchstart', e => {
  isDragging = true;
  const t = e.touches[0];
  lastMouseX = t.clientX;
  lastMouseY = t.clientY;
  handleMove(t.clientX, t.clientY); // Immediate feedback
  e.preventDefault(); // Prevent scroll when touching jar
}, { passive: false });

container.addEventListener('touchmove', e => {
  const t = e.touches[0];
  handleMove(t.clientX, t.clientY);
  e.preventDefault();
}, { passive: false });

container.addEventListener('touchend', () => {
  isDragging = false;
  // Delay hide tooltip on touch
  setTimeout(() => {
    if (!isDragging) tooltip.classList.remove('visible');
  }, 2000);
});


// â”€â”€â”€ Device Motion â”€â”€â”€
const motionBtn = document.getElementById('motion-btn');

function requestMotionPermission() {
  if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
    DeviceMotionEvent.requestPermission()
      .then(response => {
        if (response === 'granted') {
          enableMotion();
          motionBtn.textContent = 'âœ… å·²é–‹å•Ÿæ„Ÿæ‡‰';
          motionBtn.classList.add('active');
        } else {
          alert('æ¬Šé™è¢«æ‹’çµ•');
        }
      })
      .catch(console.error);
  } else {
    enableMotion();
    motionBtn.textContent = 'âœ… å·²é–‹å•Ÿæ„Ÿæ‡‰';
    motionBtn.classList.add('active');
  }
}

function enableMotion() {
  window.addEventListener('devicemotion', event => {
    const acc = event.accelerationIncludingGravity;
    if (!acc) return;
    
    // ç°¡å–®çš„æ–æ™ƒåµæ¸¬
    // é€™è£¡æˆ‘å€‘æŠŠé‡åŠ›è®ŠåŒ–ç›´æ¥è½‰æ›ç‚º shake åŠ›
    // ç‚ºäº†é¿å…æŒçºŒçš„é‡åŠ›å°è‡´æ˜Ÿæ˜Ÿè²¼ç‰†ï¼Œæˆ‘å€‘éœ€è¦éæ¿¾æ‰éœæ…‹é‡åŠ›
    // ä½†ç°¡å–®èµ·è¦‹ï¼Œæˆ‘å€‘å¯ä»¥ç”¨ acceleration (æ’é™¤é‡åŠ›) ä¾†åšæ–æ™ƒ
    
    const accNoG = event.acceleration;
    if (accNoG) {
      shakeX += (accNoG.x || 0) * 0.5;
      shakeY += -(accNoG.y || 0) * 0.5; // y è»¸é€šå¸¸ç›¸å
    }
  });
  
  // å‚¾æ–œæ§åˆ¶ (Orientation) ç”¨ä¾†åšå¾®å°çš„æ¼‚æµ®å½±éŸ¿
  window.addEventListener('deviceorientation', event => {
    const gamma = event.gamma; // Left/Right
    const beta = event.beta;   // Front/Back
    if (gamma !== null && beta !== null) {
      shakeX += gamma * 0.05;
      // æ¸›å» 45 åº¦ç•¶ä½œæ‰‹æŒåŸºæº–é»
      shakeY += (beta - 45) * 0.05;
    }
  });
}

// â”€â”€â”€ Background Stars â”€â”€â”€
for (let i = 0; i < 50; i++) {
  const star = document.createElement('div');
  star.className = 'bg-star';
  star.style.left = Math.random() * 100 + 'vw';
  star.style.top = Math.random() * 100 + 'vh';
  star.style.setProperty('--dur', (2 + Math.random() * 3) + 's');
  star.style.setProperty('--max-op', (0.1 + Math.random() * 0.4));
  star.style.animationDelay = Math.random() * 5 + 's';
  document.body.appendChild(star);
}

</script>
</body>
</html>
